<Page
    x:Class="AppWatchdog.UI.WPF.Views.Pages.AppsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:common="clr-namespace:AppWatchdog.UI.WPF.Common"
    xmlns:conv="clr-namespace:AppWatchdog.UI.WPF.Converters"
    xmlns:loc="clr-namespace:AppWatchdog.UI.WPF.Localization"
    xmlns:sharedMon="clr-namespace:AppWatchdog.Shared.Monitoring;assembly=AppWatchdog.Shared"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml">

    <Page.Resources>
        <x:Array x:Key="WatchTargetTypeValues" Type="{x:Type sharedMon:WatchTargetType}">
            <sharedMon:WatchTargetType>Executable</sharedMon:WatchTargetType>
            <sharedMon:WatchTargetType>WindowsService</sharedMon:WatchTargetType>
            <sharedMon:WatchTargetType>HttpEndpoint</sharedMon:WatchTargetType>
            <sharedMon:WatchTargetType>TcpPort</sharedMon:WatchTargetType>
        </x:Array>

        <Style x:Key="TargetBlockStyle" TargetType="{x:Type FrameworkElement}">
            <Setter Property="Visibility" Value="Collapsed" />
            <Style.Triggers />
        </Style>

    </Page.Resources>

    <Grid VerticalAlignment="Stretch" IsEnabled="{Binding IsContentEnabled}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <ui:Card
            Grid.Row="0"
            Margin="16,16,16,0"
            Padding="20">
            <StackPanel>
                <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                    <ui:SymbolIcon
                        Margin="0,0,12,0"
                        FontSize="32"
                        Symbol="AppFolder24" />
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock
                            FontSize="24"
                            FontWeight="Bold"
                            Text="{Binding Source={StaticResource Strings}, Path=[apps_title], Mode=OneWay}" />
                        <TextBlock
                            Margin="0,4,0,0"
                            FontSize="12"
                            Opacity="0.6"
                            Text="{Binding HintText}" />
                    </StackPanel>
                </StackPanel>

                <WrapPanel Margin="0,16,0,0">
                    <ui:Button
                        Margin="0,0,8,0"
                        Command="{Binding ReloadCommand}"
                        Content="{Binding Source={StaticResource Strings}, Path=[apps_reload], Mode=OneWay}"
                        Icon="{ui:SymbolIcon Symbol=SparkleCircle24}" />

                    <ui:Button
                        Appearance="Primary"
                        Command="{Binding SaveCommand}"
                        Content="{Binding Source={StaticResource Strings}, Path=[save], Mode=OneWay}"
                        Icon="{ui:SymbolIcon Symbol=Save24}"
                        IsEnabled="{Binding IsDirty}" />
                </WrapPanel>
            </StackPanel>
        </ui:Card>

        <ScrollViewer
            Grid.Row="1"
            Margin="16,16,16,16"
            HorizontalScrollBarVisibility="Disabled"
            VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!--  GENERAL  -->

                <!--  APPS  -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="280" />
                        <ColumnDefinition Width="16" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!--  LEFT  -->
                    <ui:Card Grid.Column="0" VerticalAlignment="Top">
                        <StackPanel>

                            <TextBlock
                                FontSize="16"
                                FontWeight="SemiBold"
                                Text="{Binding Source={StaticResource Strings}, Path=[apps_watched_apps_title], Mode=OneWay}" />

                            <TextBlock
                                Margin="0,5,0,5"
                                FontFamily="Consolas"
                                FontSize="11"
                                Opacity="0.7"
                                Text="{Binding Source={StaticResource Strings}, Path=[apps_rename_hint], Mode=OneWay}" />

                            <WrapPanel Margin="10,10,5,0" HorizontalAlignment="Right">
                                <ui:Button
                                    Margin="0,0,8,0"
                                    Appearance="Primary"
                                    Command="{Binding AddCommand}"
                                    Content="{Binding Source={StaticResource Strings}, Path=[apps_add], Mode=OneWay}"
                                    Icon="{ui:SymbolIcon Symbol=Add24}" />

                                <ui:Button
                                    Appearance="Secondary"
                                    Command="{Binding RemoveCommand}"
                                    Content="{Binding Source={StaticResource Strings}, Path=[apps_remove], Mode=OneWay}"
                                    Icon="{ui:SymbolIcon Symbol=Delete24}"
                                    IsEnabled="{Binding HasSelectedApp}" />
                            </WrapPanel>

                            <Separator Margin="0,5" />

                            <ui:ListView
                                Height="317"
                                ItemsSource="{Binding Apps}"
                                MouseDoubleClick="AppsListView_MouseDoubleClick"
                                ScrollViewer.VerticalScrollBarVisibility="Visible"
                                SelectedItem="{Binding SelectedApp}">

                                <ui:ListView.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Margin="10,8">
                                            <TextBlock FontWeight="SemiBold" Text="{Binding Name}" />
                                            <TextBlock
                                                FontSize="11"
                                                Opacity="0.7"
                                                Text="{Binding Type}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </ui:ListView.ItemTemplate>

                            </ui:ListView>

                        </StackPanel>
                    </ui:Card>

                    <!--  RIGHT  -->
                    <ui:Card
                        Grid.Column="2"
                        VerticalAlignment="Top"
                        IsEnabled="{Binding HasSelectedApp}">
                        <ScrollViewer>
                            <StackPanel DataContext="{Binding SelectedApp}">

                                <TextBlock
                                    Margin="0,0,0,12"
                                    FontSize="16"
                                    FontWeight="SemiBold"
                                    Text="{Binding Source={StaticResource Strings}, Path=[apps_monitoring_title], Mode=OneWay}" />

                                <!--  Enable  -->
                                <ui:ToggleSwitch Content="{Binding Source={StaticResource Strings}, Path=[apps_monitoring_enable], Mode=OneWay}" IsChecked="{Binding Enabled}" />

                                <!--  CHECK INTERVAL  -->
                                <StackPanel Margin="0,12,0,0" IsEnabled="{Binding Enabled}">
                                    <TextBlock Text="{Binding Source={StaticResource Strings}, Path=[apps_check_interval], Mode=OneWay}" />

                                    <ui:NumberBox
                                        Margin="0,4,0,0"
                                        Maximum="3600"
                                        Minimum="5"
                                        Value="{Binding CheckIntervalSeconds, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                    <TextBlock
                                        Margin="0,4,0,0"
                                        FontSize="11"
                                        Opacity="0.65"
                                        Text="{Binding Type, Converter={StaticResource CheckIntervalHintConverter}}" />
                                </StackPanel>


                                <!--  RESTART PLAN (Executable / Service)  -->
                                <StackPanel Margin="0,12,0,0" IsEnabled="{Binding Enabled}">
                                    <StackPanel.Style>
                                        <Style BasedOn="{StaticResource TargetBlockStyle}" TargetType="{x:Type StackPanel}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Type}" Value="{x:Static sharedMon:WatchTargetType.Executable}">
                                                    <Setter Property="Visibility" Value="Visible" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Type}" Value="{x:Static sharedMon:WatchTargetType.WindowsService}">
                                                    <Setter Property="Visibility" Value="Visible" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </StackPanel.Style>

                                    <ui:ToggleSwitch
                                        Content="{Binding Source={StaticResource Strings}, Path=[apps_restart_enable], Mode=OneWay}"
                                        IsChecked="{Binding RestartEnabled}" />
                                </StackPanel>

                                <!--  Target Type  -->
                                <StackPanel Margin="0,12,0,0" IsEnabled="{Binding Enabled}">
                                    <TextBlock Text="{Binding Source={StaticResource Strings}, Path=[apps_target_type], Mode=OneWay}" />
                                    <ComboBox
                                        Margin="0,4,0,0"
                                        ItemsSource="{StaticResource WatchTargetTypeValues}"
                                        SelectedItem="{Binding Type, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </StackPanel>


                                <!--  =========================  -->
                                <!--  EXECUTABLE  -->
                                <!--  =========================  -->
                                <StackPanel Margin="0,12,0,0" IsEnabled="{Binding Enabled}">
                                    <StackPanel.Style>
                                        <Style BasedOn="{StaticResource TargetBlockStyle}" TargetType="{x:Type StackPanel}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Type}" Value="{x:Static sharedMon:WatchTargetType.Executable}">
                                                    <Setter Property="Visibility" Value="Visible" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </StackPanel.Style>

                                    <TextBlock Text="{Binding Source={StaticResource Strings}, Path=[apps_exe_path], Mode=OneWay}" />

                                    <Grid Margin="0,4,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="8" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <ui:TextBox Text="{Binding ExePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                        <ui:Button
                                            Grid.Column="2"
                                            Command="{Binding BrowseExeCommand}"
                                            Icon="{ui:SymbolIcon Symbol=Folder24}"
                                            ToolTip="{Binding Source={StaticResource Strings}, Path=[apps_select_exe], Mode=OneWay}" />
                                    </Grid>

                                    <TextBlock Text="{Binding Source={StaticResource Strings}, Path=[apps_arguments], Mode=OneWay}" />
                                    <ui:TextBox Margin="0,4,0,0" Text="{Binding Arguments, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </StackPanel>

                                <!--  =========================  -->
                                <!--  WINDOWS SERVICE  -->
                                <!--  =========================  -->
                                <StackPanel Margin="0,12,0,0" IsEnabled="{Binding Enabled}">
                                    <StackPanel.Style>
                                        <Style BasedOn="{StaticResource TargetBlockStyle}" TargetType="{x:Type StackPanel}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Type}" Value="{x:Static sharedMon:WatchTargetType.WindowsService}">
                                                    <Setter Property="Visibility" Value="Visible" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </StackPanel.Style>

                                    <TextBlock Text="{Binding Source={StaticResource Strings}, Path=[apps_service_name], Mode=OneWay}" />
                                    <ui:TextBox Margin="0,4,0,0" Text="{Binding ServiceName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </StackPanel>

                                <!--  =========================  -->
                                <!--  HTTP ENDPOINT  -->
                                <!--  =========================  -->
                                <StackPanel Margin="0,12,0,0" IsEnabled="{Binding Enabled}">
                                    <StackPanel.Style>
                                        <Style BasedOn="{StaticResource TargetBlockStyle}" TargetType="{x:Type StackPanel}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Type}" Value="{x:Static sharedMon:WatchTargetType.HttpEndpoint}">
                                                    <Setter Property="Visibility" Value="Visible" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </StackPanel.Style>

                                    <TextBlock Text="{Binding Source={StaticResource Strings}, Path=[apps_url], Mode=OneWay}" />
                                    <ui:TextBox
                                        BorderBrush="{Binding IsUrlValid, Converter={StaticResource BooleanToBrushConverter}}"
                                        Text="{Binding Url, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        ToolTip="{Binding Source={StaticResource Strings}, Path=[apps_url_tooltip], Mode=OneWay}" />


                                    <TextBlock Text="{Binding Source={StaticResource Strings}, Path=[apps_expected_http_status], Mode=OneWay}" />
                                    <ui:NumberBox
                                        Margin="0,4,0,0"
                                        Maximum="599"
                                        Minimum="100"
                                        Value="{Binding ExpectedStatusCode, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </StackPanel>

                                <!--  =========================  -->
                                <!--  TCP PORT  -->
                                <!--  =========================  -->
                                <StackPanel Margin="0,12,0,0" IsEnabled="{Binding Enabled}">
                                    <StackPanel.Style>
                                        <Style BasedOn="{StaticResource TargetBlockStyle}" TargetType="{x:Type StackPanel}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Type}" Value="{x:Static sharedMon:WatchTargetType.TcpPort}">
                                                    <Setter Property="Visibility" Value="Visible" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </StackPanel.Style>

                                    <TextBlock Text="{Binding Source={StaticResource Strings}, Path=[apps_host], Mode=OneWay}" />
                                    <ui:TextBox Margin="0,4,0,8" Text="{Binding Host, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                    <TextBlock Text="{Binding Source={StaticResource Strings}, Path=[apps_port], Mode=OneWay}" />
                                    <ui:NumberBox
                                        Margin="0,4,0,0"
                                        Maximum="65535"
                                        Minimum="1"
                                        Value="{Binding Port, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </StackPanel>

                                <!--  =========================  -->
                                <!--  KUMA (Executable only)  -->
                                <!--  =========================  -->
                                <StackPanel Margin="0,12,0,0">
                                    <StackPanel.Style>
                                        <Style BasedOn="{StaticResource TargetBlockStyle}" TargetType="{x:Type StackPanel}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Type}" Value="{x:Static sharedMon:WatchTargetType.Executable}">
                                                    <Setter Property="Visibility" Value="Visible" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </StackPanel.Style>

                                    <ui:ToggleSwitch
                                        Content="{Binding Source={StaticResource Strings}, Path=[apps_kuma_enable], Mode=OneWay}"
                                        IsChecked="{Binding KumaEnabled}"
                                        IsEnabled="{Binding Enabled}" />

                                    <StackPanel Margin="0,12,0,0" IsEnabled="{Binding KumaEnabled}">

                                        <TextBlock Text="{Binding Source={StaticResource Strings}, Path=[apps_kuma_base_url], Mode=OneWay}" />
                                        <ui:TextBox Margin="0,4,0,8" Text="{Binding KumaBaseUrl, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Text="{Binding Source={StaticResource Strings}, Path=[apps_kuma_token], Mode=OneWay}" />
                                        <ui:TextBox Margin="0,4,0,8" Text="{Binding KumaPushToken, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                                        <TextBlock Text="{Binding Source={StaticResource Strings}, Path=[apps_kuma_interval], Mode=OneWay}" />
                                    </StackPanel>
                                </StackPanel>

                            </StackPanel>
                        </ScrollViewer>
                    </ui:Card>

                </Grid>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
